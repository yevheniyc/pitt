Source: https://www.coursera.org/learn/mds-introduction-to-data-centric-computing/lecture/9PVIy/understanding-and-calculating-confidence-intervals-using-sem

English
But what is the confidence interval and
how is the confidence interval calculated?
The confidence interval comes from the standard error on the mean.
This now goes back to why for the first so many weeks in the semester,
we kept running those simulations.
We kept examining the variability of the mean and
calculating through our simulations the standard error on the mean.
The confidence interval is a multiple of
the standard error on the mean around the average.
We actually saw this through our simulations, and so
let's review those ideas right now.
We begin by grouping by the categorical and
summarizing the continuous.
So gap_df.groupby, let's group by year,
and then we need to summarize the continuous variables.
We will need to calculate, for example, the count,
the number of non missing entries.
We will need to calculate the average or the conditional mean.
We will need to calculate the standard error on the mean.
And then let's reset the index.
Notice the way I've typed this out.
I planned out the summary names that I'm calculating.
And now how will I calculate it?
Life expectancy, count, life expectancy,
mean, life expectancy, SEM.
You can see for
each category of year we have the exact same number of observations or the count.
But the average, the conditional mean,
the average of life expectancy per year has a different value.
The standard error on the mean represents
our uncertainty on the average.
It's calculated as the standard deviation divided by
the square root of the number of samples.
Let's assign our grouped and
summarized dataframe to an object.
So now I will copy this code because I previously did the grouping and
the aggregation to just simply display the result.
But now I'm going to assign to a new object named gap_year_summary.
I want to do this because now let's calculate the 95%
confidence interval using the conditional means and
their respective standard error on the mean.
The lower bound on the 95% confidence interval
is the mean minus 2 times the standard error on the mean,
whereas the upper bound on the 95% confidence
interval is the mean plus 2 times the standard error on the mean.
The average minus 2 times the standard error,
up to the average plus 2 times the standard error.
These formulas come from the fact that
the distribution on the mean is a Gaussian
according to the central limit theorem.
So, do you remember when we did all those simulations,
we saw that the distribution on the average looked like a bell curve?
Well, when you have a bell curve,
95% of the variability is between the average plus or
minus the standard error, or really,
the average plus or minus the standard deviation.
But we are specifically looking at the distribution on the average.
So the width of the average is the standard error.
That's where those formulas come from.
So the central limit theorem says you can use very simple formulas to
calculate your confidence interval.
Let's go ahead and do this.
Let's define two new columns.
Life expectancy CI lower, which is the gap
year summary life expectancy average minus
2 times the life expectancy standard error.
And then a second column, life expectancy CI upper,
gap_year_summary, life expectancy
average plus 2 times the standard error.